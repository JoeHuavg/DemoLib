{"remainingRequest":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\src\\views\\users\\rolepowers\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\src\\views\\users\\rolepowers\\index.vue","mtime":1630326254246},{"path":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Amazarashi\\Documents\\P_Project\\Clothes\\后台\\Design\\Meiam.System\\Meiam.System.Web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  getPowersGroup,\r\n  getRolePowers,\r\n  updateRolePowers\r\n} from '@/api/users/rolepowers'\r\nimport { getRoles } from '@/api/users/roles'\r\n\r\nexport default {\r\n  name: 'rolepowers',\r\n  data() {\r\n    return {\r\n      // 表格高度\r\n      tableHeight: window.innerHeight,\r\n      // 角色列表遮罩层\r\n      loadingRole: true,\r\n      // 权限列表遮罩层\r\n      loadingPower: true,\r\n      // 权限列表\r\n      dataPowerResult: [],\r\n      // 角色列表\r\n      dataRoleResult: [],\r\n      // 角色id\r\n      roleId: undefined,\r\n      // 过滤查询\r\n      search: '',\r\n      // 右键当前行\r\n      powerColmun: []\r\n      // 页面布局\r\n    }\r\n  },\r\n  computed: {\r\n    size() {\r\n      return this.$store.getters.size\r\n    }\r\n  },\r\n  created() {\r\n    getPowersGroup().then(response => {\r\n      this.dataPowerResult = response.data\r\n      this.loadingPower = false\r\n    })\r\n    getRoles().then(response => {\r\n      this.dataRoleResult = response.data\r\n      this.handleSelectRole(this.dataRoleResult[0])\r\n      this.$refs.roleTable.setCurrentRow(this.dataRoleResult[0])\r\n      this.loadingRole = false\r\n    })\r\n  },\r\n  methods: {\r\n    // 选择角色\r\n    handleSelectRole(row) {\r\n      this.roleId = row.id\r\n      getRolePowers(this.roleId).then(response => {\r\n        this.dataPowerResult.forEach(v => {\r\n          v.powers.forEach(sub => {\r\n            if (response.data.indexOf(sub.id) === -1) {\r\n              sub.checked = false\r\n            } else {\r\n              sub.checked = true\r\n            }\r\n          })\r\n        })\r\n      })\r\n    },\r\n    // 全选\r\n    handleSelectAll() {\r\n      this.UpdateRolePowers(true)\r\n    },\r\n    // 取消全选\r\n    handleUnSelectAll() {\r\n      this.UpdateRolePowers(false)\r\n    },\r\n    // 保存权限\r\n    handleSubmit() {\r\n      updateRolePowers({\r\n        roleId: this.roleId,\r\n        powerIds: this.getSelectPowerIds()\r\n      }).then(response => {\r\n        this.search = ''\r\n        if (response.statusCode === 200) {\r\n          this.$message({\r\n            message: '修改成功',\r\n            type: 'success'\r\n          })\r\n        }\r\n      })\r\n    },\r\n    // 全选行\r\n    handleSelectColmun() {\r\n      this.powerColmun.powers.forEach(v => {\r\n        v.checked = true\r\n      })\r\n    },\r\n    // 取消全选行\r\n    handleUnSelectColmun() {\r\n      this.powerColmun.powers.forEach(v => {\r\n        v.checked = false\r\n      })\r\n    },\r\n    // 更新所有选中状态\r\n    UpdateRolePowers(value) {\r\n      this.dataPowerResult.forEach(v => {\r\n        v.powers.forEach(sub => {\r\n          sub.checked = value\r\n        })\r\n      })\r\n    },\r\n    // 获得勾选的id\r\n    getSelectPowerIds() {\r\n      const powerIds = []\r\n      this.dataPowerResult.forEach(v => {\r\n        v.powers.forEach(sub => {\r\n          if (sub.checked) {\r\n            powerIds.push(sub.id)\r\n          }\r\n        })\r\n      })\r\n      return powerIds\r\n    },\r\n    // 右键显示菜单\r\n    openContextMenu(row, column, event) {\r\n      // 阻止右键默认行为\r\n      event.preventDefault()\r\n      this.$nextTick(() => {\r\n        this.$refs.contextMenu.bindShowEvents(event)\r\n      })\r\n      this.powerColmun = row\r\n    }\r\n  }\r\n}\r\n",null]}